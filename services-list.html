<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QReserve: Select Room or Venue</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* CSS for Service Cards */
        #service-list-area {
            text-align: center;
            padding-bottom: 1rem;
        }
        #service-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        .service-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: left;
        }
        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .service-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .card-content {
            padding: 1rem;
        }
        .card-content h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        .card-content .price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #dc3545; /* Price highlight */
        }
        .card-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .card-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .button-secondary {
            background-color: #6c757d;
            color: white;
        }
        .button-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        /* --- Gallery Modal Styles --- */
        #galleryModal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            overflow: auto;
        }
        .gallery-modal-content {
            max-width: 900px;
            margin: 30px auto;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s;
        }
        .gallery-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .gallery-header h2 {
            margin: 0;
        }
        .gallery-close {
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            background: none;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gallery-close:hover {
            transform: scale(1.2);
        }
        .gallery-body {
            padding: 20px;
        }
        .gallery-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .gallery-image-wrapper {
            position: relative;
            width: 100%;
            max-width: 700px;
            aspect-ratio: 4/3;
            background: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gallery-image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: opacity 0.3s;
        }
        .gallery-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #666;
            font-size: 1.1rem;
        }
        .gallery-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: center;
            width: 100%;
        }
        .gallery-nav-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 50px;
            font-weight: bold;
        }
        .gallery-nav-btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .gallery-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .gallery-counter {
            text-align: center;
            font-weight: bold;
            color: #333;
            min-width: 100px;
        }

        /* --- Modal (Pop-up) Styles --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 15px;
            border-radius: var(--border-radius);
            width: 80%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover, .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        #modal-proceed-button {
            margin-top: 20px;
            width: 100%;
        }
        #search-summary {
            background-color: #e9f7ef;
            color: #386641;
            padding: 8px;
            border-radius: 6px;
            margin-top: 0.75rem;
            font-weight: bold;
        }
                /* --- NEW CSS for Layout and Sidebar --- */
        .booking-layout-container {
            display: flex;
            gap: 20px; /* Space between the two columns */
            align-items: flex-start; /* Keep the sidebar at the top */
        }

        #service-cards-container {
            /* Takes up 2/4 of the space */
            flex: 3; 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        #booking-summary-sidebar {
            /* Takes up 1/4 of the space */
            flex: 1; 
            position: sticky; /* Keep it visible while scrolling */
            top: 100px; /* Offset from the top of the viewport */
            background-color: #f8f8f8;
            border: 1px solid #e0e0e0;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .summary-details p:last-child {
            margin-top: 5px;
        }

        .summary-total {
            text-align: center;
            padding: 10px 0;
            border-top: 1px dashed #ccc;
        }

        .summary-inclusions {
            margin-top: 15px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 12px 14px;
        }

        .summary-inclusions h4 {
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .summary-inclusions ul {
            padding-left: 18px;
            margin: 0;
            color: #444;
        }

        .summary-inclusions li + li {
            margin-top: 6px;
        }

        .button-primary.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }
        /* Ensure the grid gap is still applied if you used it previously: */
        /* #service-cards-container { ... gap: 25px; ... } */

        /* --- Mobile Responsive Styles --- */
        @media (max-width: 768px) {
            .booking-layout-container {
                display: flex;
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
                margin-top: 1.5rem;
            }

            #service-cards-container {
                flex: 1;
                display: grid;
                grid-template-columns: 1fr;
                gap: 20px;
            }

            #booking-summary-sidebar {
                flex: 1;
                position: static;
                width: 100%;
                margin-bottom: 20px;
                background-color: #f8f8f8;
                border: 1px solid #e0e0e0;
                padding: 20px;
                border-radius: var(--border-radius);
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                order: -1; /* Move sidebar to top on mobile */
            }

            #service-cards-container {
                grid-template-columns: 1fr;
            }

            .service-card {
                margin-bottom: 10px;
            }

            .summary-details p {
                font-size: 0.95rem;
            }

            #summary-price {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            .booking-layout-container {
                gap: 15px;
            }

            #booking-summary-sidebar {
                padding: 15px;
            }

            #booking-summary-sidebar h3 {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }

            .summary-inclusions {
                margin-top: 12px;
                padding: 10px 12px;
            }

            .summary-inclusions ul {
                padding-left: 15px;
                font-size: 0.9rem;
            }

            #sidebar-proceed-button {
                padding: 12px !important;
                font-size: 0.95rem;
            }

            .service-card img {
                height: 150px;
            }

            .card-content {
                padding: 1rem;
            }

            .card-content h3 {
                font-size: 1rem;
            }

            .card-content .price {
                font-size: 1rem;
            }

            .card-buttons {
                gap: 8px;
                margin-top: 8px;
            }

            .card-buttons button {
                padding: 8px;
                font-size: 0.9rem;
            }

            .gallery-image-wrapper {
                max-width: 100%;
                aspect-ratio: 3/2;
            }

            .gallery-controls {
                flex-wrap: wrap;
                gap: 10px;
            }

            .gallery-nav-btn {
                padding: 10px 16px;
                font-size: 1rem;
            }

            .gallery-counter {
                min-width: 90px;
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="nav-logo" aria-label="Tito Renz Resort">
                <img src="images/logo.png" alt="Tito Renz Resort Logo">
            </a>

            <ul>
                </ul>
            <div class="nav-right" id="navRight"></div>
        </nav>
    </header>

    <section class="page-hero-section">

        <div class="hero-content">
            <br><br>
            <h1>Our Amenities</h1>
            <p>Experience luxury and comfort with our world-class facilities</p>
        </div>
    </section>

    <main class="has-fixed-header-offset services-parallax">
        <div class="services-parallax-inner">
            <div id="promo-banner" style="display: none; text-align: center; padding: 10px; background-color: var(--color-accent); color: white; margin-bottom: 20px;">
            </div>
            <section id="service-list-area" class="container">
                <!-- Filters (reuse amenities filter styles) -->
                <section class="amenities-filters-section" style="background-image: none; padding-top: 1rem;">
                    <div class="filter-card">
                        <div class="filter-controls">
                            <div class="filter-group">
                                <label for="services-category-filter">Category</label>
                                <select id="services-category-filter" class="filter-select">
                                    <option value="all">All</option>
                                    <option value="room">Room</option>
                                    <option value="venue">Venue</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="services-type-filter">Type</label>
                                <select id="services-type-filter" class="filter-select">
                                    <option value="all">All</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="services-capacity-filter">Max Guests</label>
                                <select id="services-capacity-filter" class="filter-select">
                                    <option value="0">Any</option>
                                    <option value="2">Up to 2</option>
                                    <option value="4">Up to 4</option>
                                    <option value="8">Up to 8</option>
                                    <option value="20">20 and above</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!--<div id="search-summary">
                    Viewing availability for: <span id="dates-display">...</span> | Guests: <span id="guests-display">...</span>
                </div>
                <p>Click on any service card below to view details and proceed with your reservation (DFD 4.0).</p>...-->

                <div class="booking-layout-container">
                    <div id="service-cards-container">
                    </div>

                    <!-- Selected Items Sidebar -->
                    <aside id="booking-summary-sidebar">
                        <h3>üõçÔ∏è Selected Items</h3>
                        <div id="selected-items-list" style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
                            <p style="color: #999; font-size: 0.9rem;">No items selected yet</p>
                        </div>

                        <hr style="margin: 15px 0;">

                        <!-- Promo Code Section -->
                        <div style="margin-bottom: 15px;">
                            <label for="promo-code-input" style="font-weight: 600; font-size: 0.9rem; color: #555;">Promo Code:</label>
                            <div style="display: flex; gap: 8px; margin-top: 8px;">
                                <input type="text" id="promo-code-input" placeholder="Enter code" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem;">
                                <button id="apply-promo-btn" class="button-primary" style="padding: 8px 16px; font-size: 0.9rem; white-space: nowrap;" onclick="applyPromoCode(); return false;">Apply</button>
                            </div>
                            <div id="promo-message" style="margin-top: 8px; font-size: 0.85rem;"></div>
                        </div>

                        <div class="summary-total">
                            <div id="original-price-display" style="display: none; margin-bottom: 8px;">
                                <p style="font-size: 0.85rem; color: #999; text-decoration: line-through; margin: 0;">Original: <span id="summary-original">‚Ç±0.00</span></p>
                            </div>
                            <p style="font-size: 0.95rem; font-weight: 600; color: #666;">Total:</p>
                            <p id="summary-subtotal" style="font-size: 1.3rem; font-weight: bold; color: var(--primary-color);">‚Ç±0.00</p>
                            <div id="discount-display" style="display: none; margin-top: 4px;">
                                <p style="font-size: 0.85rem; color: #28a745; font-weight: 600; margin: 0;">Discount: -<span id="discount-amount">‚Ç±0.00</span></p>
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button id="clear-selections-btn" class="button-secondary" style="flex: 1; padding: 0.75rem; font-size: 0.9rem;" onclick="clearSelectedItems(); return false;">Clear All</button>
                            <a href="#" class="button-primary" id="sidebar-proceed-button" style="flex: 2; text-align: center; padding: 0.75rem;" onclick="proceedToReservation(); return false;">Proceed</a>
                        </div>
                    </aside>
                </div>
            </section>
        </div>
    </main>

    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modal-name">Service Name</h2>
            <p>Max Guests: <span id="modal-max-guests"></span></p>
            <p id="modal-description" style="margin-top: 15px;"></p>
            
            <!-- Check-in Date Selection -->
            <div style="margin-top: 20px;">
                <label for="modal-checkin-date" style="font-weight: bold;">Check-in Date:</label>
                <input type="date" id="modal-checkin-date" style="width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; font-weight: 500;" required>
            </div>
            
            <!-- Check-in Time Selection -->
            <div style="margin-top: 20px;">
                <label for="modal-checkin-time" style="font-weight: bold;">Check-in Time:</label>
                <select id="modal-checkin-time" style="width: 100%; padding: 8px; margin-top: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="">-- Select --</option>
                    <option value="8">8:00 AM</option>
                    <option value="9">9:00 AM</option>
                    <option value="10">10:00 AM</option>
                    <option value="11">11:00 AM</option>
                    <option value="12">12:00 PM</option>
                    <option value="13">1:00 PM</option>
                    <option value="14">2:00 PM</option>
                    <option value="15">3:00 PM</option>
                    <option value="16">4:00 PM</option>
                    <option value="17">5:00 PM</option>
                    <option value="18">6:00 PM</option>
                    <option value="19">7:00 PM</option>
                    <option value="20">8:00 PM</option>
                </select>
            </div>
            
            <!-- Duration Selection -->
            <div id="modal-duration-section" style="margin-top: 20px;">
                <label for="modal-duration-select" style="font-weight: bold;">Select Duration:</label>
                <select id="modal-duration-select" style="width: 100%; padding: 8px; margin-top: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="">-- Select --</option>
                </select>
            </div>
            
            <!-- Check-out Date Display (Auto-calculated) -->
            <div id="modal-checkout-display" style="margin-top: 15px; padding: 10px; background: #e8f5e9; border-radius: 4px; display: none;">
                <p style="margin: 0; font-weight: 600; color: #2e7d32;">Check-out: <span id="modal-checkout-date">--</span></p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem; color: #1b5e20;">Check-out Time: <span id="modal-checkout-time">--</span></p>
            </div>
            
            <p style="margin-top: 15px;">Price: <span id="modal-price" style="font-weight: bold; font-size: 1.3rem; color: var(--primary-color);">Select duration</span></p>
            
            <!-- Inclusions Display -->
            <div id="modal-inclusions" style="margin-top: 20px; display: none;">
                <h4>Inclusions:</h4>
                <ul id="modal-inclusions-list" style="list-style: disc; padding-left: 25px;"></ul>
            </div>
            
            <a href="#" id="modal-proceed-button" class="button-primary" style="margin-top: 20px; pointer-events: none; opacity: 0.5;">Add to Selection</a>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="galleryModal" class="modal">
        <div class="gallery-modal-content">
            <div class="gallery-header">
                <h2 id="gallery-title">Service Photos</h2>
                <button class="gallery-close" onclick="closeGalleryModal()">&times;</button>
            </div>
            <div class="gallery-body">
                <div class="gallery-container">
                    <div class="gallery-image-wrapper">
                        <img id="gallery-image" src="" alt="Service photo">
                    </div>
                    <div class="gallery-controls">
                        <button class="gallery-nav-btn" id="gallery-prev-btn" onclick="previousGalleryImage()">‚Üê Previous</button>
                        <div class="gallery-counter">
                            <span id="gallery-counter-text">Photo 1 of 1</span>
                        </div>
                        <button class="gallery-nav-btn" id="gallery-next-btn" onclick="nextGalleryImage()">Next ‚Üí</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section contact-info">
                <h3>Tito Renz Resort</h3>
                <p>Your seamless booking experience starts here.</p>
                <p>üìç Norzagaray, Bulacan, Philippines</p>
                <p>üìû 0977 246 8920 or 0916 640 3411</p>
                <p>üìß titorenznorzagaray@gmail.com</p>
            </div>

            <div class="footer-section quick-links">
                <h3>Quick Links</h3>
                <ul>
                    <!-- Dynamically populated by renderFooterQuickLinks() -->
                </ul>
            </div>

            <div class="footer-section about-contact">
                <h3>About & Contact</h3>
                <ul>
                    <li><a href="about.html">Our Story</a></li>
                    <li><a href="contact.html">Send Us a Message</a></li>
                    <li><a href="help.html">Help / Guides</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 QReserve Project - All Rights Reserved.</p>
        </div>
    </footer>

        <script src="notifications.js"></script>
        <script src="ui-core.js"></script>
        <script src="auth-profile.js"></script>
        <script src="reservation.js"></script>
        <script src="amenity-selector.js"></script>
        <script>
        // Override showServiceModal for multi-amenity selection mode
        window.showServiceModalForAmenitySelection = function(serviceId) {
            const services = window.getActiveServices ? window.getActiveServices() : (window.resortServices || []);
            const service = services.find(s => (s._id || s.id) === serviceId);
            if (!service) return;

            const modal = document.getElementById("serviceModal");
            if (!modal) return;

            // Detect if this is Private Pool Area
            const isPrivatePool = service.name && service.name.toLowerCase().includes('private pool area');

            // Set basic info
            document.getElementById("modal-name").textContent = service.name;
            document.getElementById("modal-max-guests").textContent = service.max_guests || "N/A";
            document.getElementById("modal-description").textContent = service.description || "No description available.";

            // Setup check-in date picker (default today for rooms, tomorrow for venues)
            const checkinInput = document.getElementById("modal-checkin-date");
            if (checkinInput) {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1);

                const serviceType = (service.type || '').toLowerCase();
                const serviceCategory = (service.category || '').toLowerCase();
                const isVenue = serviceType === 'venue' ||
                    serviceCategory.includes('event_space') ||
                    serviceCategory.includes('water_facility') ||
                    (service.name && service.name.toLowerCase().includes('private pool'));

                const defaultDate = isVenue ? tomorrow : today;

                // Format as YYYY-MM-DD in local timezone
                const year = defaultDate.getFullYear();
                const month = String(defaultDate.getMonth() + 1).padStart(2, '0');
                const day = String(defaultDate.getDate()).padStart(2, '0');
                const defaultDateStr = `${year}-${month}-${day}`;

                checkinInput.min = defaultDateStr;
                checkinInput.value = defaultDateStr; // Default to today or tomorrow

                // Add validation to prevent selecting dates before the minimum
                checkinInput.onchange = function() {
                    const selectedDate = new Date(checkinInput.value + 'T00:00:00');
                    const minDateCheck = new Date(defaultDate);
                    minDateCheck.setHours(0, 0, 0, 0);
                    selectedDate.setHours(0, 0, 0, 0);

                    if (selectedDate < minDateCheck) {
                        showToast(
                            isVenue ? 'Please select a date from tomorrow onwards' : 'Please select today or a future date',
                            'warning'
                        );
                        checkinInput.value = defaultDateStr; // Reset to default
                    }

                    updateTimeOptionsAvailability(checkinInput, document.getElementById("modal-checkin-time"));
                    calculateCheckoutDate();
                };
            }
            
            // Setup check-in time selector
            const timeInput = document.getElementById("modal-checkin-time");
            if (timeInput) {
                // Special handling for Private Pool Area - only 8am or 8pm
                if (isPrivatePool) {
                    timeInput.innerHTML = `
                        <option value="">-- Select --</option>
                        <option value="8">8:00 AM</option>
                        <option value="20">8:00 PM</option>
                    `;
                    // Add onchange handler to update price when time changes for private pool
                    timeInput.onchange = function() {
                        calculateCheckoutDate();
                        if (isPrivatePool) {
                            updatePrivatePoolPrice(serviceId, service);
                        }
                    };
                } else {
                    // Reset to default time options for non-private pool services
                    timeInput.innerHTML = `
                        <option value="">-- Select --</option>
                        <option value="8">8:00 AM</option>
                        <option value="9">9:00 AM</option>
                        <option value="10">10:00 AM</option>
                        <option value="11">11:00 AM</option>
                        <option value="12">12:00 PM</option>
                        <option value="13">1:00 PM</option>
                        <option value="14">2:00 PM</option>
                        <option value="15">3:00 PM</option>
                        <option value="16">4:00 PM</option>
                        <option value="17">5:00 PM</option>
                        <option value="18">6:00 PM</option>
                        <option value="19">7:00 PM</option>
                        <option value="20">8:00 PM</option>
                    `;
                    timeInput.onchange = calculateCheckoutDate;
                }

                updateTimeOptionsAvailability(checkinInput, timeInput);
            }

            // Populate duration/time slot select
            const select = document.getElementById("modal-duration-select");
            if (select) {
                select.innerHTML = '<option value="">-- Select --</option>';
                
                // Special handling for Private Pool Area - fixed 9 hours duration
                if (isPrivatePool) {
                    const option = document.createElement("option");
                    option.value = "private-pool-9h";
                    option.textContent = "9 Hours - Price depends on check-in time";
                    option.setAttribute('data-hours', '9');
                    select.appendChild(option);
                    
                    // For private pool, always select the only option
                    select.value = "private-pool-9h";
                } else {
                    // Normal services - show all durations
                    const options = [...(service.timeSlots || []), ...(service.durations || [])];
                    options.forEach(opt => {
                        const option = document.createElement("option");
                        option.value = opt.id;
                        option.textContent = `${opt.label} - ‚Ç±${opt.price.toLocaleString()}`;
                        // Store nights count as data attribute for calculation
                        option.setAttribute('data-nights', opt.nights || 0);
                        select.appendChild(option);
                    });
                }

                const options = [...(service.timeSlots || []), ...(service.durations || [])];

                // CUSTOM: Handle selecting duration for amenity
                select.onchange = function() {
                    const priceEl = document.getElementById("modal-price");
                    const proceedBtn = document.getElementById("modal-proceed-button");
                    
                    if (select.value) {
                        if (isPrivatePool) {
                            // For private pool, price depends on check-in time
                            updatePrivatePoolPrice(serviceId, service);
                        } else {
                            // Calculate price normally
                            const durationOption = options.find(o => o.id === select.value);
                            const price = durationOption ? durationOption.price : 0;
                            
                            if (priceEl) {
                                priceEl.textContent = `‚Ç±${price.toLocaleString()}`;
                            }
                        }
                        
                        // Calculate check-out date
                        calculateCheckoutDate();
                        
                        // Validate button state
                        updateModalProceedButton(serviceId, service, options, isPrivatePool);
                    } else {
                        if (priceEl) priceEl.textContent = "Select duration";
                        if (proceedBtn) {
                            proceedBtn.style.opacity = "0.5";
                            proceedBtn.style.pointerEvents = "none";
                            proceedBtn.onclick = null;
                        }
                        // Hide checkout display
                        const checkoutDisplay = document.getElementById("modal-checkout-display");
                        if (checkoutDisplay) checkoutDisplay.style.display = "none";
                    }
                };
                
                // If private pool, trigger price update after setup
                if (isPrivatePool && select.value) {
                    updatePrivatePoolPrice(serviceId, service);
                }
            }

            // Populate Inclusions
            const inclusionsContainer = document.getElementById("modal-inclusions");
            const inclusionsList = document.getElementById("modal-inclusions-list");
            if (inclusionsContainer && inclusionsList) {
                if (service.inclusions && service.inclusions.length > 0) {
                    inclusionsList.innerHTML = service.inclusions.map(inc => {
                        const text = String(inc).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;');
                        return `<li>${text}</li>`;
                    }).join("");
                    inclusionsContainer.style.display = "block";
                } else {
                    inclusionsContainer.style.display = "none";
                }
            }

            modal.style.display = "block";
        };

        function getLocalDateString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function updateTimeOptionsAvailability(checkinInput, timeInput) {
            if (!checkinInput || !timeInput) return;

            const selectedDate = checkinInput.value;
            if (!selectedDate) return;

            const todayStr = getLocalDateString(new Date());
            const isToday = selectedDate === todayStr;
            const currentHour = new Date().getHours();

            Array.from(timeInput.options).forEach(option => {
                if (!option.value) {
                    option.disabled = false;
                    option.style.color = '';
                    return;
                }

                const optionHour = parseInt(option.value, 10);
                const shouldDisable = isToday && !Number.isNaN(optionHour) && optionHour <= currentHour;
                option.disabled = shouldDisable;
                option.style.color = shouldDisable ? '#999' : '';
            });

            if (timeInput.value) {
                const selectedOption = timeInput.options[timeInput.selectedIndex];
                if (selectedOption && selectedOption.disabled) {
                    timeInput.value = '';
                }
            }
        }

        // Helper: Calculate check-out date based on check-in + duration
        function calculateCheckoutDate() {
            const checkinInput = document.getElementById("modal-checkin-date");
            const checkinTimeInput = document.getElementById("modal-checkin-time");
            const durationSelect = document.getElementById("modal-duration-select");
            const checkoutDisplay = document.getElementById("modal-checkout-display");
            const checkoutDateSpan = document.getElementById("modal-checkout-date");
            const checkoutTimeSpan = document.getElementById("modal-checkout-time");

            if (!checkinInput || !durationSelect || !checkoutDisplay || !checkoutDateSpan || !checkoutTimeSpan) return;

            const checkinValue = checkinInput.value;
            const durationId = durationSelect.value;
            const checkinTime = checkinTimeInput ? checkinTimeInput.value : '';

            if (!checkinValue || !durationId) {
                checkoutDisplay.style.display = "none";
                return;
            }

            // Get duration option details
            const selectedOption = durationSelect.options[durationSelect.selectedIndex];
            const durationLabel = selectedOption.text; // e.g., "22 Hours - ‚Ç±6,000" or "2 Nights - ‚Ç±15,000"
            
            // Parse duration to extract hours or nights
            let hoursToAdd = 0;
            let daysToAdd = 0;
            let isHourlyDuration = false;
            
            // Check if this is Private Pool Area (fixed 9 hours)
            if (durationId === 'private-pool-9h') {
                hoursToAdd = 9;
                isHourlyDuration = true;
            } else if (durationLabel.includes('Hour')) {
                // Extract hours from label (e.g., "22 Hours" ‚Üí 22)
                const hourMatch = durationLabel.match(/(\d+)\s*Hour/);
                if (hourMatch) {
                    hoursToAdd = parseInt(hourMatch[1]);
                    isHourlyDuration = true;
                }
            } else if (durationLabel.includes('Night')) {
                // Extract nights from label (e.g., "2 Nights" ‚Üí 2)
                const nightMatch = durationLabel.match(/(\d+)\s*Night/);
                if (nightMatch) {
                    daysToAdd = parseInt(nightMatch[1]);
                }
            } else {
                // Fallback to data-nights attribute
                const nights = parseInt(selectedOption.getAttribute('data-nights') || '0');
                daysToAdd = nights;
            }

            // Calculate check-out date and time
            const checkinDate = new Date(checkinValue);
            const checkoutDate = new Date(checkinDate);
            let checkoutTime = '--';

            if (isHourlyDuration && hoursToAdd > 0) {
                // For hourly durations: add hours to the start time
                const checkinHour = parseInt(checkinTime); // e.g., 8, 14, 20
                checkinDate.setHours(checkinHour);
                checkoutDate.setHours(checkinHour);
                checkoutDate.setHours(checkoutDate.getHours() + hoursToAdd);
                
                // Get hours and minutes from calculated checkout
                const checkoutHours = checkoutDate.getHours();
                const checkoutMins = checkoutDate.getMinutes();
                const ampm = checkoutHours >= 12 ? 'PM' : 'AM';
                const displayHours = checkoutHours % 12 || 12;
                checkoutTime = `${displayHours}:${checkoutMins.toString().padStart(2, '0')} ${ampm}`;
            } else if (daysToAdd > 0) {
                // For night-based durations: add days, checkout at same time
                checkoutDate.setDate(checkoutDate.getDate() + daysToAdd);
                const checkinHour = parseInt(checkinTime);
                const ampm = checkinHour >= 12 ? 'PM' : 'AM';
                const displayHours = checkinHour % 12 || 12;
                checkoutTime = `${displayHours}:00 ${ampm}`;
            } else {
                // Fallback: same time as check-in
                const checkinHour = parseInt(checkinTime);
                const ampm = checkinHour >= 12 ? 'PM' : 'AM';
                const displayHours = checkinHour % 12 || 12;
                checkoutTime = `${displayHours}:00 ${ampm}`;
            }

            // Format checkout date as readable
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
            const readableDate = checkoutDate.toLocaleDateString('en-US', dateOptions);
            
            checkoutDateSpan.textContent = readableDate;
            checkoutTimeSpan.textContent = checkoutTime;
            
            checkoutDisplay.style.display = "block";
        }

        // Helper: Update price for Private Pool Area based on check-in time
        function updatePrivatePoolPrice(serviceId, service) {
            const checkinTimeInput = document.getElementById("modal-checkin-time");
            const durationSelect = document.getElementById("modal-duration-select");
            const priceEl = document.getElementById("modal-price");
            const proceedBtn = document.getElementById("modal-proceed-button");
            
            if (!checkinTimeInput || !durationSelect || !priceEl) return;
            
            const checkinTime = checkinTimeInput.value;
            const durationId = durationSelect.value;
            
            if (durationId === 'private-pool-9h' && checkinTime) {
                let price = 0;
                
                // 8am = ‚Ç±12,000, 8pm = ‚Ç±15,000
                if (checkinTime === '8') {
                    price = 12000;
                } else if (checkinTime === '20') {
                    price = 15000;
                }
                
                priceEl.textContent = `‚Ç±${price.toLocaleString()}`;
                
                // Store price as data attribute for later use
                durationSelect.setAttribute('data-private-pool-price', price);
                
                // Update button state
                const options = []; // Empty for private pool
                updateModalProceedButton(serviceId, service, options, true);
            } else {
                priceEl.textContent = "Select check-in time";
                if (proceedBtn) {
                    proceedBtn.style.opacity = "0.5";
                    proceedBtn.style.pointerEvents = "none";
                }
            }
        }

        // Helper: Update proceed button state with all validations
        function updateModalProceedButton(serviceId, service, options, isPrivatePool = false) {
            const proceedBtn = document.getElementById("modal-proceed-button");
            const checkinInput = document.getElementById("modal-checkin-date");
            const checkinTimeInput = document.getElementById("modal-checkin-time");
            const durationSelect = document.getElementById("modal-duration-select");

            if (!proceedBtn || !checkinInput || !durationSelect) return;

            const checkinValue = checkinInput.value;
            const checkinTime = checkinTimeInput ? checkinTimeInput.value : '';
            const durationId = durationSelect.value;

            // Enable button only if check-in date, check-in time, and duration are all selected
            if (checkinValue && checkinTime && durationId) {
                let durationOption = null;
                let price = 0;
                
                if (isPrivatePool && durationId === 'private-pool-9h') {
                    // For private pool, get price from data attribute
                    price = parseInt(durationSelect.getAttribute('data-private-pool-price') || '0');
                    
                    // Create a synthetic duration option for private pool
                    durationOption = {
                        id: durationId,
                        label: '9 Hours',
                        price: price,
                        hours: 9
                    };
                } else {
                    // Normal service - find from options
                    durationOption = options.find(o => o.id === durationId);
                }
                
                proceedBtn.style.opacity = "1";
                proceedBtn.style.pointerEvents = "auto";
                
                // Override button click to add amenity with dates (async handler)
                proceedBtn.onclick = async function(e) {
                    e.preventDefault();
                    await addAmenityFromModal(serviceId, durationId, service, durationOption, checkinValue, checkinTime, isPrivatePool);
                };
            } else {
                proceedBtn.style.opacity = "0.5";
                proceedBtn.style.pointerEvents = "none";
                proceedBtn.onclick = null;
            }
        }

        // Helper: Find and add complimentary villa room for Private Pool
        async function addComplimentaryVillaRoom(checkInDate, checkInTime, checkOutDate, checkOutTime) {
            const services = window.getActiveServices ? window.getActiveServices() : (window.resortServices || []);
            
            // Filter to villa/room services only
            const villaServices = services.filter(service => {
                const isVilla = service.type && (service.type.toLowerCase().includes('room') || service.type.toLowerCase().includes('villa'));
                if (!isVilla) return false;
                
                // Check if not already selected
                if (isAmenitySelected(service._id || service.id, service.assetNumber)) {
                    return false;
                }
                
                return true;
            });
            
            if (villaServices.length === 0) {
                console.log('‚ö†Ô∏è No available villa room found for complimentary inclusion');
                return false;
            }
            
            // Check backend for availability
            try {
                const response = await fetch('/api/reservations/check-service-types-availability', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        checkInDate: checkInDate,
                        checkInTime: checkInTime,
                        checkOutDate: checkOutDate,
                        checkOutTime: checkOutTime,
                        serviceTypes: ['villa', 'room']
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Backend availability check failed: ${response.status}`);
                }
                
                const availabilityData = await response.json();
                
                // Check if resort is fully booked due to Private Pool
                if (availabilityData.resortFullyBooked) {
                    console.log('üîí Resort fully booked:', availabilityData.blockReason);
                    showToast(availabilityData.blockReason || 'The resort is fully booked for the selected date and time', 'error');
                    return false;
                }
                
                // availabilityData contains list of available service IDs
                const availableServiceIds = availabilityData.availableServices || [];
                
                if (availableServiceIds.length === 0) {
                    console.log('‚ö†Ô∏è No villa rooms available on the selected date/time');
                    showToast('Villa rooms are not available for the selected date and time', 'warning');
                    return false;
                }
                
                // Find first villa that's available on the backend
                const availableVilla = villaServices.find(villa => {
                    const villaId = villa._id || villa.id;
                    return availableServiceIds.includes(villaId) || availableServiceIds.includes(villaId.toString());
                });
                
                if (!availableVilla) {
                    console.log('‚ö†Ô∏è No matching villa from frontend list found in available services');
                    showToast('Villa rooms are not available for the selected date and time', 'warning');
                    return false;
                }
                
                return await createAndAddComplimentaryVilla(availableVilla, checkInDate, checkInTime);
                
            } catch (error) {
                console.error('‚ùå Backend availability check error:', error);
                // Fallback: just pick the first villa if backend check fails
                console.log('‚ÑπÔ∏è Falling back to first available villa (backend check failed)');
                return await createAndAddComplimentaryVilla(villaServices[0], checkInDate, checkInTime);
            }
        }
        
        // Helper: Create and add complimentary villa with 12-hour duration
        async function createAndAddComplimentaryVilla(villaRoom, checkInDate, checkInTime) {
            // Calculate check-out for 12-hour villa duration
            const villaCheckinDateObj = new Date(checkInDate);
            const villaCheckoutDateObj = new Date(villaCheckinDateObj);
            
            const checkinHour = parseInt(checkInTime);
            villaCheckinDateObj.setHours(checkinHour);
            villaCheckoutDateObj.setHours(checkinHour);
            villaCheckoutDateObj.setHours(villaCheckoutDateObj.getHours() + 12); // 12-hour duration
            
            // Get checkout time
            const checkoutHours = villaCheckoutDateObj.getHours();
            const checkoutMins = villaCheckoutDateObj.getMinutes();
            const ampm = checkoutHours >= 12 ? 'PM' : 'AM';
            const displayHours = checkoutHours % 12 || 12;
            const villaCheckoutTime = `${displayHours}:${checkoutMins.toString().padStart(2, '0')} ${ampm}`;
            const villaCheckoutDate = villaCheckoutDateObj.toISOString().split('T')[0];
            
            // Create complimentary villa amenity object
            const villaAmenity = {
                serviceId: villaRoom._id || villaRoom.id,
                assetNumber: villaRoom.assetNumber || null,
                serviceName: villaRoom.name,
                serviceType: 'accommodation',
                selectedDuration: 'complimentary-with-pool',
                durationLabel: '12 Hours (Complimentary with Private Pool)',
                nights: 0,
                hours: 12,
                checkIn: checkInDate,
                checkInTime: checkInTime,
                checkOut: villaCheckoutDate,
                checkOutTime: villaCheckoutTime,
                price: 0, // FREE - complimentary
                inclusions: villaRoom.inclusions || [],
                image: villaRoom.image,
                isComplimentary: true, // Flag to identify this as a complimentary item
                linkedTo: 'private-pool-area' // Link it to the private pool
            };
            
            // Add the complimentary villa room
            if (addAmenity(villaAmenity)) {
                console.log(`‚ú® Complimentary villa room "${villaRoom.name}" (12 hours) added with Private Pool Area`);
                return true;
            }
            
            return false;
        }

        // Function to add amenity from modal
        async function addAmenityFromModal(serviceId, durationId, service, durationOption, checkInDate, checkInTime, isPrivatePool = false) {
            if (!durationOption || !checkInDate || !checkInTime) {
                showToast('Error: Missing duration, check-in date, or check-in time', 'error');
                return;
            }

            // Parse duration label to handle both hours and nights
            const durationLabel = durationOption.label || durationOption.name || durationId;
            let hoursToAdd = 0;
            let daysToAdd = 0;
            let isHourlyDuration = false;
            
            if (isPrivatePool && durationId === 'private-pool-9h') {
                // Private Pool - fixed 9 hours
                hoursToAdd = 9;
                isHourlyDuration = true;
            } else if (durationLabel.includes('Hour')) {
                const hourMatch = durationLabel.match(/(\d+)\s*Hour/);
                if (hourMatch) {
                    hoursToAdd = parseInt(hourMatch[1]);
                    isHourlyDuration = true;
                }
            } else if (durationLabel.includes('Night')) {
                const nightMatch = durationLabel.match(/(\d+)\s*Night/);
                if (nightMatch) {
                    daysToAdd = parseInt(nightMatch[1]);
                }
            } else {
                // Fallback: use nights from duration option
                daysToAdd = durationOption.nights || 0;
            }

            // Calculate check-out date and time
            const checkinDateObj = new Date(checkInDate);
            const checkoutDateObj = new Date(checkinDateObj);
            let checkOutTime = '--';

            if (isHourlyDuration && hoursToAdd > 0) {
                // For hourly durations: add hours to the start time
                const checkinHour = parseInt(checkInTime); // e.g., 8, 14, 20
                checkinDateObj.setHours(checkinHour);
                checkoutDateObj.setHours(checkinHour);
                checkoutDateObj.setHours(checkoutDateObj.getHours() + hoursToAdd);
                
                // Get checkout time
                const checkoutHours = checkoutDateObj.getHours();
                const checkoutMins = checkoutDateObj.getMinutes();
                const ampm = checkoutHours >= 12 ? 'PM' : 'AM';
                const displayHours = checkoutHours % 12 || 12;
                checkOutTime = `${displayHours}:${checkoutMins.toString().padStart(2, '0')} ${ampm}`;
            } else if (daysToAdd > 0) {
                // For night-based durations: add days
                checkoutDateObj.setDate(checkoutDateObj.getDate() + daysToAdd);
                const checkinHour = parseInt(checkInTime);
                const ampm = checkinHour >= 12 ? 'PM' : 'AM';
                const displayHours = checkinHour % 12 || 12;
                checkOutTime = `${displayHours}:00 ${ampm}`;
            }

            const checkOutDate = checkoutDateObj.toISOString().split('T')[0];

            // Check for duplicate
            if (isAmenitySelected(serviceId, service.assetNumber)) {
                showToast('This item is already selected', 'warning');
                return;
            }

            // Create amenity object with dates and check-in time
            const amenity = {
                serviceId: serviceId,
                assetNumber: service.assetNumber || null,
                serviceName: service.name,
                serviceType: service.type || 'accommodation',
                selectedDuration: durationId,
                durationLabel: isPrivatePool ? `9 Hours (${checkInTime === '8' ? '8am' : '8pm'})` : durationLabel,
                nights: daysToAdd,
                hours: hoursToAdd,
                checkIn: checkInDate,
                checkInTime: checkInTime,
                checkOut: checkOutDate,
                checkOutTime: checkOutTime,
                price: durationOption.price || 0,
                inclusions: service.inclusions || [],
                image: service.image
            };

            // Add to amenity selector
            if (addAmenity(amenity)) {
                // If this is Private Pool Area, also add complimentary villa room (async)
                if (isPrivatePool) {
                    const villaAdded = await addComplimentaryVillaRoom(checkInDate, checkInTime, checkOutDate, checkOutTime);
                    if (!villaAdded) {
                        showToast('‚ö†Ô∏è Private Pool added, but no villa available for the selected date', 'warning');
                    }
                }
                
                // Re-render sidebar
                renderSelectedItems();
                
                // Show success message
                if (isPrivatePool) {
                    showToast(`‚úÖ ${service.name} + Complimentary Villa Room added to selection!`, 'success');
                } else {
                    showToast(`‚úÖ ${service.name} added to selection!`, 'success');
                }
                
                // Close modal
                const modal = document.getElementById("serviceModal");
                modal.style.display = "none";
                
                // Clear inputs for next selection
                const checkinInput = document.getElementById("modal-checkin-date");
                const timeInput = document.getElementById("modal-checkin-time");
                const select = document.getElementById("modal-duration-select");
                if (checkinInput) {
                    const today = new Date();
                    const tomorrow = new Date(today);
                    tomorrow.setDate(today.getDate() + 1);
                    
                    // Format as YYYY-MM-DD in local timezone
                    const year = tomorrow.getFullYear();
                    const month = String(tomorrow.getMonth() + 1).padStart(2, '0');
                    const day = String(tomorrow.getDate()).padStart(2, '0');
                    checkinInput.value = `${year}-${month}-${day}`;
                }
                if (timeInput) timeInput.value = '';
                if (select) select.value = '';
                
                // Hide checkout display
                const checkoutDisplay = document.getElementById("modal-checkout-display");
                if (checkoutDisplay) checkoutDisplay.style.display = "none";
            } else {
                showToast('Failed to add amenity', 'error');
            }
        }

        // Override window.showServiceModal to use amenity selection mode
        window.showServiceModal = window.showServiceModalForAmenitySelection;

        // Initialize amenity selector on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeAmenitySelector();
            console.log('‚úÖ Services-list page ready for multi-amenity selection');
        });

        // Gallery Modal Functions
        let currentGalleryImages = [];
        let currentImageIndex = 0;

        function showGalleryModal(serviceId) {
            const services = window.getActiveServices ? window.getActiveServices() : (window.resortServices || []);
            const service = services.find(s => (s._id || s.id) === serviceId);
            if (!service) return;

            const galleryModal = document.getElementById('galleryModal');
            const galleryTitle = document.getElementById('gallery-title');

            if (!galleryModal) return;

            // Set the title
            galleryTitle.textContent = service.name + ' - Photos';

            // Get gallery images from service
            const galleryImages = service.gallery || [];

            // Check if service has the main image
            const serviceImage = service.image || null;

            // Combine all images for display with proper URL handling (matches admin table logic)
            let allImages = [];
            if (serviceImage) {
                let imgUrl = serviceImage;
                // Handle /uploads/ prefix: strip leading slash if present
                if (imgUrl && imgUrl.startsWith('/uploads/')) {
                    imgUrl = imgUrl.replace(/^\//, '');
                }
                // If still not a full URL and doesn't start with images/, it's a filename needing uploads prefix
                if (imgUrl && !imgUrl.startsWith('http') && !imgUrl.startsWith('images/') && !imgUrl.startsWith('uploads/')) {
                    imgUrl = `uploads/${imgUrl}`;
                }
                allImages.push(imgUrl);
            }
            if (Array.isArray(galleryImages)) {
                const processedGallery = galleryImages.map(img => {
                    let imgUrl = img;
                    // Handle /uploads/ prefix: strip leading slash if present
                    if (imgUrl && imgUrl.startsWith('/uploads/')) {
                        imgUrl = imgUrl.replace(/^\//, '');
                    }
                    // If still not a full URL and doesn't start with images/, it's a filename needing uploads prefix
                    if (imgUrl && !imgUrl.startsWith('http') && !imgUrl.startsWith('images/') && !imgUrl.startsWith('uploads/')) {
                        imgUrl = `uploads/${imgUrl}`;
                    }
                    return imgUrl;
                });
                allImages = allImages.concat(processedGallery);
            }

            // Remove duplicates
            allImages = [...new Set(allImages)];

            // Store images globally and reset index
            currentGalleryImages = allImages;
            currentImageIndex = 0;

            // Populate the gallery
            if (allImages.length === 0) {
                document.getElementById('gallery-image').src = '';
                document.getElementById('gallery-counter-text').textContent = 'No photos available';
                document.getElementById('gallery-prev-btn').disabled = true;
                document.getElementById('gallery-next-btn').disabled = true;
            } else {
                updateGalleryDisplay();
            }

            // Show the modal
            galleryModal.style.display = 'block';
        }

        function updateGalleryDisplay() {
            if (currentGalleryImages.length === 0) return;

            const img = document.getElementById('gallery-image');
            const counterText = document.getElementById('gallery-counter-text');
            const prevBtn = document.getElementById('gallery-prev-btn');
            const nextBtn = document.getElementById('gallery-next-btn');

            // Set image and counter
            img.src = currentGalleryImages[currentImageIndex];
            counterText.textContent = `Photo ${currentImageIndex + 1} of ${currentGalleryImages.length}`;

            // Update button states
            prevBtn.disabled = currentImageIndex === 0;
            nextBtn.disabled = currentImageIndex === currentGalleryImages.length - 1;
        }

        function previousGalleryImage() {
            if (currentImageIndex > 0) {
                currentImageIndex--;
                updateGalleryDisplay();
            }
        }

        function nextGalleryImage() {
            if (currentImageIndex < currentGalleryImages.length - 1) {
                currentImageIndex++;
                updateGalleryDisplay();
            }
        }

        function closeGalleryModal() {
            const galleryModal = document.getElementById('galleryModal');
            if (galleryModal) {
                galleryModal.style.display = 'none';
            }
        }

        // Close gallery modal when clicking outside
        window.addEventListener('click', function(event) {
            const galleryModal = document.getElementById('galleryModal');
            if (event.target === galleryModal) {
                closeGalleryModal();
            }
        });

        // Keyboard navigation for gallery
        document.addEventListener('keydown', function(event) {
            const galleryModal = document.getElementById('galleryModal');
            if (galleryModal && galleryModal.style.display === 'block') {
                if (event.key === 'ArrowLeft') {
                    previousGalleryImage();
                } else if (event.key === 'ArrowRight') {
                    nextGalleryImage();
                } else if (event.key === 'Escape') {
                    closeGalleryModal();
                }
            }
        });
        
        </script>
</body>
</html>
