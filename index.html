<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Tito Renz Norzagaray Resort</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <nav>
        <a href="index.html" class="nav-logo" aria-label="Tito Renz Resort">
          <img src="images/logo.png" alt="Tito Renz Resort Logo" />
        </a>
        <ul>
          <li><a href="index.html" class="active">Home</a></li>
          <li><a href="help.html">Help</a></li>
        </ul>
        <div class="nav-right" id="navRight"></div>
      </nav>
    </header>

    <main>
      <section id="hero-new">
        <div class="hero-content-wrapper">
          <h1>Tito Renz Norzagaray Resort</h1>
          <p class="tagline">Norzagaray's Best All In 1 Place</p>
          <a href="services-list.html" class="button-secondary" onclick="window.location.href='services-list.html'; return false;">Book Now</a>
        </div>
      </section>

      <section id="featured-amenities" class="hero-parallax">
        <div class="hero-content-wrapper">
          <h2>What We Offer at Tito Renz Resort</h2>

          <!-- Main Section Navigation -->
          <div class="amenities-section-nav">
            <button class="amenities-section-btn active" data-section="rooms">
              Rooms
            </button>
            <button class="amenities-section-btn" data-section="events">
              Events Place
            </button>
            <button class="amenities-section-btn" data-section="pool">
              Pool Area
            </button>
          </div>

          <!-- Carousel Container -->
          <div class="amenities-carousel-wrapper">
            <!-- Rooms Section Carousel -->
            <div class="amenities-carousel active" data-section="rooms">
              <button class="carousel-nav-btn prev">‹</button>
              <div class="carousel-slides">
                <div class="carousel-slide active">
                  <div
                    class="slide-image"
                    style="
                      background: url('images/Villa_room.jpg') center/cover
                        no-repeat;
                    "
                  ></div>
                  <h4 class="carousel-service-link" data-service-type="villa">Villa</h4>
                  <p>
                    Spacious villa accommodations with premium amenities and
                    privacy.
                  </p>
                </div>
                <div class="carousel-slide">
                  <div
                    class="slide-image"
                    style="
                      background: url('images/Charm_room_1.jpg') center/cover
                        no-repeat;
                    "
                  ></div>
                  <h4 class="carousel-service-link" data-service-type="charm">Charm</h4>
                  <p>
                    Cozy and intimate rooms with all the comfort and character
                    you need.
                  </p>
                </div>
                <div class="carousel-slide">
                  <div
                    class="slide-image"
                    style="
                      background: url('images/home-room.jpg') center/cover
                        no-repeat;
                    "
                  ></div>
                  <h4 class="carousel-service-link" data-service-type="home">Home</h4>
                  <p>
                    Full home experience with kitchen facilities and spacious
                    living areas.
                  </p>
                </div>
              </div>
              <h2>
                <button class="carousel-nav-btn next">›</button>
              </h2>
            
            </div>

            <!-- Events Place Section Carousel -->
            <div class="amenities-carousel" data-section="events">
              <h2>
                <button class="carousel-nav-btn prev">‹</button>
              </h2>
              <div class="carousel-slides">
                <div class="carousel-slide active">
                  <div
                    class="slide-image"
                    style="
                      background: url('images/Cloverleaf_Hall.jpg') center/cover
                        no-repeat;
                    "
                  ></div>
                  <h4 class="carousel-service-link" data-service-type="hall">Clover Leaf Hall</h4>
                  <p>
                    Large multi-purpose venue perfect for conferences, weddings,
                    and grand celebrations.
                  </p>
                </div>
                <div class="carousel-slide">
                  <div
                    class="slide-image"
                    style="
                      background: url('images/2nd_Floor_Resto_Hall.jpg')
                        center/cover no-repeat;
                    "
                  ></div>
                  <h4 class="carousel-service-link" data-service-type="hall">Resto Hall</h4>
                  <p>
                    Intimate dining space ideal for family gatherings, corporate
                    lunches, and small events.
                  </p>
                </div>
              </div>
              <button class="carousel-nav-btn next">›</button>
            </div>

            <!-- Pool Area Section Carousel -->
            <div class="amenities-carousel" data-section="pool">
              <button class="carousel-nav-btn prev">‹</button>
              <div class="carousel-slides">
                <div class="carousel-slide active">
                  <div
                    class="slide-image"
                    style="
                      background: url('images/Pool_Area.jpg') center/cover
                        no-repeat;
                    "
                  ></div>
                  <h4 class="carousel-service-link" data-service-type="pool">Adult Pool</h4>
                  <p>
                    Olympic-sized main pool with diving areas and relaxing
                    shallow zones.
                  </p>
                </div>
                <div class="carousel-slide">
                  <div
                    class="slide-image"
                    style="
                      background: url('images/Pool_Area_other_View.jpg')
                        center/cover no-repeat;
                    "
                  ></div>
                  <h4 class="carousel-service-link" data-service-type="pool">Kiddie Pool</h4>
                  <p>
                    Safe and shallow pool designed specifically for children's
                    enjoyment and safety.
                  </p>
                </div>
                <div class="carousel-slide">
                  <div
                    class="slide-image"
                    style="
                      background: url('images/Pool_Area_other_View_2.jpg')
                        center/cover no-repeat;
                    "
                  ></div>
                  <h4 class="carousel-service-link" data-service-type="pool">Pool Cottages</h4>
                  <p>
                    Exclusive cottages poolside with direct pool access and
                    private lounging areas.
                  </p>
                </div>
              </div>
              <button class="carousel-nav-btn next">›</button>
            </div>
          </div>

        </div>
      </section>

      <section
        id="promotions-blocks"
        class="container"
        style="
          margin-top: 2rem;
          background-color: #f5f4f1;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        "
      >
        <h2>Active Promotions</h2>
        <div id="active-promotions-list">
          <p>Loading promotions...</p>
        </div>

        <hr style="margin: 1.5rem 0" />

        <h2>Currently Blocked Dates</h2>
        <div id="public-blocked-dates">
          <p>Loading blocked dates...</p>
        </div>

      </section>

      <!-- What Our Customers Say Carousel -->
      <section id="customer-reviews-carousel" style="background: #f8f9fa; padding: 2.5rem 0 2rem 0; margin-top: 2rem;">
        <div class="container" style="max-width: 900px; margin: 0 auto; text-align: center;">
          <h2 style="margin-bottom: 1.5rem; color: var(--primary-color, #28a745); font-size: 2.5rem;">What Our Customers Say</h2>
          <div id="reviews-carousel-wrapper" style="position: relative;">
                            <button id="carousel-prev" aria-label="Previous" style="position: absolute; left: 0; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 5rem; color: #888; cursor: pointer; z-index: 2;">&#8249;</button>
                            <img id="carousel-image" src="feedback/1.jpg" alt="Customer Review Photo" style="max-width: 100%; max-height: 500px; border-radius: 12px; box-shadow: 0 4px 16px #0002; transition: opacity 0.3s;" />
                            <button id="carousel-next" aria-label="Next" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 5rem; color: #888; cursor: pointer; z-index: 2;">&#8250;</button>
          </div>
        </div>
      </section>

      <!-- <section id="services">
        <h2>What We Offer at Tito Renz Resort</h2>
        <div class="service-cards">
          <div class="card">
            <h3>Standard Rooms</h3>
            <p>
              Comfortable and modern air-conditioned rooms perfect for
              individuals or couples. Enjoy a restful stay with all essential
              amenities.
            </p>
            <p class="price">Starts at P2,500</p>
          </div>
          <div class="card">
            <h3>Family Cottages</h3>
            <p>
              Spacious, private cottages ideal for family gatherings or larger
              groups. Includes a dedicated dining area and dedicated grill area.
            </p>
            <p class="price">Starts at P4,000</p>
          </div>
          <div class="card">
            <h3>Pool Area Rental</h3>
            <p>
              Reserve our main pool and pavilion area for birthdays, team
              building, or other special events. Perfect for large groups.
            </p>
            <p class="price">Starts at P8,000</p>
          </div>
        </div>
      </section> -->
    </main>

    <footer></footer>

    <script src="notifications.js"></script>
    <script src="ui-core.js"></script>
    <script src="auth-profile.js"></script>
    <script src="cart-system.js"></script>
    <script src="mobile-responsive.js"></script>

    <script>
    // Redirect admin/manager users to their dashboard
    (function redirectAdminUsers() {
        const userRole = sessionStorage.getItem('qreserve_user_role');
        if (userRole === 'admin' || userRole === 'manager') {
            const dashboardPage = userRole === 'admin' ? '/admin/admin-dashboard.html' : '/manager/manager-dashboard.html';
            window.location.href = dashboardPage;
        }
    })();

    // Cached map of service IDs to names for blocked-date display
    let serviceNameMap = null;
    async function getServiceNameMap() {
      if (serviceNameMap) return serviceNameMap;
      try {
        const res = await fetch('http://localhost:3000/api/services');
        const data = await res.json();
        const services = Array.isArray(data)
          ? data
          : (data.success && Array.isArray(data.services))
            ? data.services
            : [];
        const map = {};
        services.forEach(svc => {
          const id = svc._id || svc.id;
          const name = svc.name || svc.serviceName || svc.title || svc.serviceType || 'Service';
          if (id) map[id] = name;
        });
        serviceNameMap = map;
      } catch (_e) {
        serviceNameMap = {};
      }
      return serviceNameMap;
    }

    // --- Fetch and Render Promotions & Blocked Dates ---
    async function fetchAndRenderPromotions() {
      const container = document.getElementById('active-promotions-list');
      if (!container) return;
      try {
        // Use the public active promo list (non-expired, under usage limit)
        const res = await fetch('http://localhost:3000/api/promocodes/active/list');
        const data = await res.json();
        const promos = Array.isArray(data)
          ? data
          : (data.success && Array.isArray(data.promos))
            ? data.promos
            : [];

        if (!promos.length) {
          container.innerHTML = '<p>No active promotions at this time.</p>';
          return;
        }

        container.innerHTML = promos.map(promo => {
          const discountPct = promo.discountPercentage ? Math.round(promo.discountPercentage * 100) : 0;
          const expiresRaw = promo.expirationDate || promo.expiryDate;
          const expires = window.formatDate ? window.formatDate(expiresRaw) : expiresRaw;
          const usageLeft = (typeof promo.usageLimit === 'number' && typeof promo.timesUsed === 'number')
            ? Math.max(promo.usageLimit - promo.timesUsed, 0)
            : null;
          const usageLine = promo.usageLimit
            ? `${usageLeft !== null ? usageLeft : promo.usageLimit} use(s) left of ${promo.usageLimit}`
            : '';
          const minPurchaseLine = promo.minPurchaseAmount
            ? `Min purchase: ₱${parseFloat(promo.minPurchaseAmount).toLocaleString()}`
            : '';
          return `
            <div class="promo-block" style="margin-bottom: 1rem; padding: 10px; border-radius: 6px; background: #f7f7f7; box-shadow: 0 2px 8px #0001;">
              <div><strong style="color: var(--primary-color, #1f7ed0);">${promo.code}</strong> — ${discountPct}% off</div>
              <div style="color: #555; font-size: 0.95em;">Valid until: ${expires || 'N/A'}</div>
              ${usageLine ? `<div style="color:#666; font-size: 0.9em;">${usageLine}</div>` : ''}
              ${minPurchaseLine ? `<div style="color:#666; font-size: 0.9em;">${minPurchaseLine}</div>` : ''}
              ${promo.description ? `<div style="margin-top:4px; color:#555; font-size:0.95em;">${promo.description}</div>` : ''}
            </div>
          `;
        }).join('');
      } catch (e) {
        container.innerHTML = '<p style="color: #c00;">Failed to load promotions.</p>';
      }
    }

    async function fetchAndRenderBlockedDates() {
      const container = document.getElementById('public-blocked-dates');
      if (!container) return;
      try {
        const serviceMap = await getServiceNameMap();
        const res = await fetch('http://localhost:3000/api/blocked-dates/active/list');
        const data = await res.json();
        const blocks = Array.isArray(data)
          ? data
          : (data.success && Array.isArray(data.blockedDates))
            ? data.blockedDates
            : (data.success && Array.isArray(data.blocks))
              ? data.blocks
              : [];

        if (!blocks.length) {
          container.innerHTML = '<p>No blocked dates at this time.</p>';
          return;
        }

        container.innerHTML = '<ul style="padding-left: 1.2em;">' + blocks.map(block => {
          const start = window.formatDate ? window.formatDate(block.startDate) : block.startDate;
          const end = window.formatDate ? window.formatDate(block.endDate) : block.endDate;
          const servicesText = (block.appliesToAllServices !== false && (!block.serviceIds || block.serviceIds.length === 0))
            ? 'All services'
            : (Array.isArray(block.serviceIds) && block.serviceIds.length > 0)
              ? block.serviceIds.map(id => serviceMap[id] || id).join(', ')
              : 'All services';
          const reasonText = block.reason ? ` — ${block.reason}` : '';
          return `<li><strong>${start}</strong> to <strong>${end}</strong>${reasonText}<div style="color:#555; font-size:0.9em;">Services: ${servicesText}</div></li>`;
        }).join('') + '</ul>';
      } catch (e) {
        container.innerHTML = '<p style="color: #c00;">Failed to load blocked dates.</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      fetchAndRenderPromotions();
      fetchAndRenderBlockedDates();

      // Make carousel titles clickable to jump to filtered services
      document.querySelectorAll('.carousel-service-link[data-service-type]').forEach((el) => {
        const serviceType = el.getAttribute('data-service-type');
        el.style.cursor = 'pointer';
        el.setAttribute('role', 'link');
        el.setAttribute('tabindex', '0');
        el.addEventListener('click', () => {
          window.location.href = `services-list.html?type=${encodeURIComponent(serviceType)}`;
        });
        el.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            window.location.href = `services-list.html?type=${encodeURIComponent(serviceType)}`;
          }
        });
      });

      // Customer Reviews Carousel Logic
      const images = ['feedback/1.jpg', 'feedback/2.jpg', 'feedback/3.jpg', 'feedback/4.jpg', 'feedback/5.jpg', 'feedback/6.jpg'];
      let current = 0;
      const carouselImg = document.getElementById('carousel-image');
      const prevBtn = document.getElementById('carousel-prev');
      const nextBtn = document.getElementById('carousel-next');
      let isTransitioning = false;
      function updateCarousel() {
        if (isTransitioning) return;
        isTransitioning = true;
        carouselImg.style.opacity = 0.3;
        setTimeout(() => {
          carouselImg.src = images[current];
          carouselImg.onload = () => {
            carouselImg.style.opacity = 1;
            setTimeout(() => { isTransitioning = false; }, 150);
          };
        }, 150);
      }
      prevBtn.addEventListener('click', function() {
        if (isTransitioning) return;
        current = (current - 1 + images.length) % images.length;
        updateCarousel();
      });
      nextBtn.addEventListener('click', function() {
        if (isTransitioning) return;
        current = (current + 1) % images.length;
        updateCarousel();
      });
    });
    </script>
  </body>
</html>
