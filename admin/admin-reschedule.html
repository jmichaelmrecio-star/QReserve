<!-- Reschedule Requests Management Section -->
<section id="reschedule-management" class="tab-pane">
  <div class="card p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">ðŸ“… Reschedule Requests</h2>
      <div class="d-flex gap-2">
        <button
          id="refresh-reschedule-requests"
          class="btn btn-outline-primary btn-sm"
        >
          Refresh
        </button>
      </div>
    </div>

    <div class="table-responsive">
      <table
        id="reschedule-requests-table"
        class="table table-striped table-hover"
      >
        <thead class="table-dark">
          <tr>
            <th>Reservation ID</th>
            <th>Guest Name</th>
            <th>Current Dates</th>
            <th>Proposed Dates</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Requested At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="reschedule-requests-list"></tbody>
      </table>
    </div>
  </div>

  <!-- Confirm Approve Modal -->
  <div
    class="modal fade"
    id="confirmApproveModal"
    tabindex="-1"
    aria-labelledby="confirmApproveLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="confirmApproveLabel">
            Approve Reschedule Request
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <p id="confirmApproveMessage"></p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="button" class="btn btn-success" id="confirmApproveBtn">
            Approve
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reject Reason Modal -->
  <div
    class="modal fade"
    id="rejectReasonModal"
    tabindex="-1"
    aria-labelledby="rejectReasonLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="rejectReasonLabel">
            Reject Reschedule Request
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <p id="rejectReasonMessage"></p>
          <div class="form-group">
            <label for="rejectionReason">Reason for Rejection:</label>
            <textarea
              class="form-control"
              id="rejectionReason"
              rows="4"
              placeholder="Please explain why you are rejecting this reschedule request..."
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="button" class="btn btn-danger" id="confirmRejectBtn">
            Reject
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Result Modal -->
  <div
    class="modal fade"
    id="resultModal"
    tabindex="-1"
    aria-labelledby="resultLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" id="resultHeader">
          <h5 class="modal-title" id="resultLabel"></h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <p id="resultMessage"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
            OK
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="/admin/admin-reschedule.js"></script>
<script>
  // Initialize reschedule management when component loads
  (function initRescheduleManagement() {
    // Render initial requests
    if (typeof renderRescheduleRequests === "function") {
      renderRescheduleRequests();
    }

    // Bind refresh button
    const refreshBtn = document.getElementById("refresh-reschedule-requests");
    if (refreshBtn && !refreshBtn.dataset.bound) {
      refreshBtn.dataset.bound = "true";
      refreshBtn.addEventListener("click", function () {
        renderRescheduleRequests();
      });
    }

    // Bind modal buttons - use setTimeout to ensure elements are loaded
    setTimeout(function () {
      const confirmApproveBtn = document.getElementById("confirmApproveBtn");
      if (confirmApproveBtn && !confirmApproveBtn.dataset.bound) {
        confirmApproveBtn.dataset.bound = "true";
        confirmApproveBtn.addEventListener("click", function () {
          if (typeof approveRescheduleRequest === "function") {
            approveRescheduleRequest();
          } else {
            console.error("approveRescheduleRequest function not found");
          }
        });
        console.log("âœ… Approve button listener bound");
      }

      const confirmRejectBtn = document.getElementById("confirmRejectBtn");
      if (confirmRejectBtn && !confirmRejectBtn.dataset.bound) {
        confirmRejectBtn.dataset.bound = "true";
        confirmRejectBtn.addEventListener("click", function () {
          if (typeof rejectRescheduleRequest === "function") {
            rejectRescheduleRequest();
          } else {
            console.error("rejectRescheduleRequest function not found");
          }
        });
        console.log("âœ… Reject button listener bound");
      }
    }, 100);
  })();
</script>
